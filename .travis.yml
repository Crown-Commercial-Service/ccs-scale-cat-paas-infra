# Define environment
language: bash

# Only build pushes to master branch
branches:
  only:
    - "/^(feature|bugfix)\\/SCC-[0-9]+.*$/"
    - "/^(release)\\/.*$/"
    - develop
    - main

# Install dependencies
before_install:
  - sudo rm -Rf terraform_"$TF_VERSION"_linux_amd64.zip
  - sudo rm -Rf terraform
  - wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip
  - unzip terraform_"$TF_VERSION"_linux_amd64.zip
  - sudo mv terraform /usr/local/bin/
  - rm terraform_"$TF_VERSION"_linux_amd64.zip

deploy:
  # SBX - modify CF_ENVIRONMENT as required
  - provider: script
    skip_cleanup: true
    script: CF_ENVIRONMENT=sbx2 bash ./deploy.sh
    on:
      all_branches: true
      condition: "${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH} =~ ^(feature|bugfix)\\/SCC-[0-9]+.*$"

  # DEVELOP
  - provider: script
    skip_cleanup: true
    script: CF_ENVIRONMENT=dev bash ./deploy.sh
    on:
      branch: develop

  # INT (SIT)
  - provider: script
    skip_cleanup: true
    script: CF_ENVIRONMENT=int bash ./deploy.sh
    on:
      branch: release/int

  # NFT
  - provider: script
    skip_cleanup: true
    script: CF_ENVIRONMENT=nft bash ./deploy.sh
    on:
      branch: release/nft

env:
  global:
    - TF_VERSION=1.0.5
    # ACCESS_KEY_ID
    - secure: "tzYXsEadC/BT8BJHW/IFRr0CNT28f1XrZ1VuUIcIWQd1eMMM3l92gNY/vYlnTpK9E91RVtTk6bLZ/KO3Ez4zmNjDHPnZTl20K4QxWi9YNFl7kAej/vd1ZMaoPfiWdN1p3RWx9n4BXh38rx8Gwk+ZsFAePVAnLW9gtNB758Pm3XyIfglDWH0LTbZK1QGyo4LhlDanE53NNYl6GabTBYrUv0kPT09UMrwzPlAD15koU/qD1EY9ZD1zK/OWH3K4nmD1JTxbxMVlKo2Lw7/UrKeGzrmPwOMnC2rKvFh8oRCNPPK38rBPfLp3v+EI+mI9kNM/SZ8kFLrw683/Qz9V6d4VZMZn79uihRjcILykv5JhlY+rktPd2WoXO3PDsjZ0TV2mWeyrvLiPJMKpAc32knu3ubl7V5EYbAB6Zo6xtlQq3qZW0gbwOVCU5QkJ0Q/C55Tk5ZIpiMkLw1nGr+SnNJk9W4bsC7R/nS/54P9zQ09vIDbAijEnW74IuvRuzrEfu1jrzJVcYWioiPKVXtfAoxmN3u0Brz2lfbVdDWUwTw42ADLykeWGNW6Bk+YNHZiQ3cojiXySgJZJ3YU0cBoKafP2Evu4jkPdLETetY9rfKPyFw9/ZGCIjgl79hd+q9oiDPwxiDdNgGGAcv7gWZHc/Zagl7wIMy/Y0N5iXyIH7qhCY1A="
    # SECRET_ACCESS_KEY
    - secure: "lNio6wdSmPR1CjOrLB87cXrrGMgOiwBP+en1oKILhGNJboDn5yY551ySXAMyZZ15LJ3fDfVv8dA2Z+W+smLGUfEF0u2avPCXJWNJWFTN1gx7lIX/xyP8c28f2OEUkEMypjUpDImO/6pCBYgCOqaRCAAq/HHpvxd3zUjt8oA/ZnaFKns+P7fJtq8y5T4P6AyvlQfwWVDLTzz4V6zYLsgi8p84POhXOycxTqDzDgJPsOANn3OZx8nrORJD5dmelrOz9YRx2zhhOmw1+ANgdWuDFIINBgi0Sh6h9GnVxn5ksJilgeIHyRhDcUt2eU8exqFYXpKFitjOoIPn0dLXTIuYra5wrbjHW5bIN6Q69IA+Zw6f+lPvrUYJG2bnHCPzxKgMMzdZ/a4pCVaaoaSbJIBFzUmRk19w9mz+IhimDpyVNF3LriOhbCUUVuXrKZPCYVFN51hr4af97hR1HHRxLwKdwo4K8GA0USlesE1ULVpxtepPcGRIXFaVtHfHTE0G1X9lQpTBRXbMObiXTOaUjwsuyU+vdjcFs6JVdzo0MHmQWbYKAB0JAOemzdw2mApxP5meJtRLxSOIaKEvIiR3WbzVVFRCw2wW8lSWQiF2zmh0ZS4Ejmf/BX7uVusNVVqQm677dmvzdGMmNb+RWsF73s9ekjlLXZ5/kP5yQGvfNzjXvkw="
    # S3_STATE_BUCKET_NAME
    - secure: "12j+ec/8ANQ0eN8wmNm1ZdmYYeFgKJIJ38YqBdZHgPesh5ZVT92G2QOBTJkZtu5lnQgJv57Lun+3Vynd/wiKyYv+vjBgzSB2npSoiPj23mx6CQoBecMGiKz9tHfOoBw24xL+G7nFJ8bOU+IlU+N5udiovZqw5yPmpSrgntoHiQaA/zaHMwKMCEWM+hJKTOT+PT5K4jOQ+pPHIIjwtO+hrUXdle7j1AeRXE4beu1AE35YTyF+TRBXwDUFMX5cuYjPhnU4EzyF4i8gr7xYQBlLVEZU9S8+RAzpmBYSnbkz2D/CobCacz8mjSHm8OFd/9bor9uk10VYL8syZP0rpHd24o9iXHYwSk2xhHXzIkIh2L/OZI0wYO1QtZTgDG2+ey62T/r5v5L0RNexpO4S1jam4EnjDNrNmeLuigcRZOqCCKydtWV06DxXTGeVNWkoo2IauvYIY8NhaH0DUmI/B12aqDGwnY7RfeMUqLS8l9BZMFZSzYRPDs5ELcyDPq/QOZr1QyRb4R34BpZFgVXWIUHNiUcY2+hDNgB2Ek2bEFf+/72V/Gtq9zUt+NnAFbNyd96m5Bh5GxL1DW8opBltCzpVPdX0h4b2gNT+XuYgEMqeT0JrLRNeN6eR33v/Dlvopt4jA4+7/PK3u/z6fvWBekqyOeZW0ydXVp0UcOnu+yhVjSM="
    # DDB_LOCK_TABLE_NAME
    - secure: "UFH3Xhd0WQBLCuKQQ+Yokm7s5Gcovw86sGJQD7UETFBb7PZ7/YMi2jrTJJQher3pszHeiCFY48gBrUFHMwCRAjNdVGudTU3mFwSGR54LTc1+bv0PJ3qEYpXThm5lptiOjKkYYg12XwYBEphEGgZyQuWTg1MSD8fhDFrxRE8LsPr0jHfqlwZG0RhjrCxGEmPmVy58w6W/3kUBWu78fw/h2E2qLoVqp8h4+PmEKyNmLv12y9juTVVy8qPSLOLU1Tldm7lTp+h8aE0AZ6VU9ttkBxO8bj6GyFrYrSh9tx/ru335Xpx3zLn2ylQE7pGACHeubaXIhIhOleiLGM7rgw9CefF0/16ZFOlQttbzlrH353MKk8oKDdcFROeT8KgOkdSm81dTtyO+6TIMCzstYaLRD6uQiuAJ6Ooq4FMUexDmSpiHX8TPpUBEMjxZwwB2u8GlHDfkYN+h8Ns0Ch492qHjjKhbwxAhPP/1Kelr54XCNLR7mppQT+vaHDcwLij7vGZe9OyNwwmAICrzmdEdRJ545pY9sF/KohowrZf6C38/ueSnqML2ZdOeuUI//cD3E88/Uye0WFqmszpWEsykVMMjOBM+KtflVOQKYZ0l/wR5ril1wJZ13aTcheq0FU9NODhXG0GdZYHwbLPWPIGVmpugKYwceWsCGzLHAAbPJ6UCNAk="
    # CF_USERNAME
    - secure: "S4PNeU3BNh22fb9BYFs42lazEFBsp6LClzuidBL658dyPeVTPWisUoF3M9VZEJ0hh/pjZKDjy3XjhwGfMuuFBo9wZE1t6dZHvscF4I1lrDBVAXPeODAOmXHabPsNbiHfkrn/dgvML0I+H4FY4qrPwtzAk1G5uR7YaklmvHA/Ja8YY9QuifT5ZoVetaeC4yfpAvCuZoQpFd8o75Ouso4usDR0yZ/xGYhYMOujJam4we8jK6zdJhw/jthSnKsSkDq0VznH/lKMJgA0nEErPdbMlgGhp2/CoEOjqINWE2cGF9B0duqP/Zq1s2fgPQoyTlzFdTnL0ZJVLDKRLOuyexmGOmuiuCtZVkvD5R69zGOZX+wbGyLBgEzlF0Ph3NPOCGvDz+JMuYG2EZSZFV35cooPwUtd1AIqLZK514uLNNDBIID1sIjrfxO9Bua2k/Yx8kKtseSLlbxzbvrid/0mBHfHayKmKsWx994Rq2pse1y2LDPJnwrnnpSn3OFBqx+tj24oONcrh5dYywmi3xPJCh9W+K6Ju1+TxGZL7TssmQiRscvCMQB442HdQ+FzlVvOjoAV5/uOyv17bV/kojlZiJIPwzIdU8bcA7zFgjkBO+q2ArAvU5tl+lHTzw0f3mgrfJSH3K7kcm6ZtxdhXzIEjOtA/s8GSKtf4dA3qfToqphtG2Q="
    # CF_PASSWORD
    - secure: "kbSa/As9EAcYY18XFlbgBToKN3wfmQLVi738p7HJDFTU9OIrt2lLSuT3J3NF3Azzd9/3tkV2keXW8CBrjT/02dTwkA6pUabtTfMi/SsY6VlUUThKrEfBmUFi+WGHIYgtXMdbS51dqatMSOqtXChxiQJ7+xRXS98n1VST0roPwAsPH1m1kXBXQyGht0uowWwjvje41n95TnglFQcm7umYD7WcH4X2EkECyYTZSF1w+IUHKCyqVulDq/RO7QezJQBAUEzlyo8hXIpjF5kwdm4Dj8t4qkULqGcrWlb9uJie6bgebVI3/UmaBBSoFwYitKl7Y42/rbW1LSwv77CA1kuemz0AvR22Afx8T3pHICM7pQv7BURUnjmIOV/eMebGQOx1qvgJ00bPLmkh9TnKowESHHyloTYb2EfKAA+uaw9axqFRWYUSjpXjjuH3kWL6T/G21TobqZr4ZQAMPLB5iHw9NGf4d6PAj1KBOjQjuUlgA6YKvjZ3p8/KPuFXqk9EYkrwUuoVRjn6A/B0qdxw20+KFjmWn9qCKwGkzVMjgFm3Aa9pDw555FRG5DuCId9KKgwbap3crtmZ77OPWSIh66dSRCc5qkCXrTtTJeu85WCuINnCdZsqdD/1TUhg++yl5m4M+gi1Lhlv8Xhkd7JVLlnDA0BJ+aFPx8++qhr0MXycrGI="
